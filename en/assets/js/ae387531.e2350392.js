"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[3352],{5732:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>i,contentTitle:()=>c,default:()=>m,frontMatter:()=>l,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"customize/custom-llm-server","title":"Custom LLM Server","description":"Custom LLM Server Example","source":"@site/docs/customize/custom-llm-server.md","sourceDirName":"customize","slug":"/customize/custom-llm-server","permalink":"/en/docs/customize/custom-llm-server","draft":false,"unlisted":false,"editUrl":"https://github.com/unit-mesh/auto-dev/tree/master/docs/docs/customize/custom-llm-server.md","tags":[],"version":"current","frontMatter":{"layout":"default","title":"Custom LLM Server","parent":"Customize Features","nav_order":14,"permalink":"/custom/llm-server"},"sidebar":"tutorialSidebar","previous":{"title":"Custom Documentation","permalink":"/en/docs/customize/custom-living-documentation"},"next":{"title":"Custom Quick Action","permalink":"/en/docs/customize/custom-quick-action"}}');var o=n(4848),r=n(8453);const l={layout:"default",title:"Custom LLM Server",parent:"Customize Features",nav_order:14,permalink:"/custom/llm-server"},c="Custom LLM Server",i={},a=[{value:"Custom LLM Server Example",id:"custom-llm-server-example",level:2},{value:"DeepSeek AI examples",id:"deepseek-ai-examples",level:3},{value:"\u96f6\u4e00\u4e07\u7269 examples",id:"\u96f6\u4e00\u4e07\u7269-examples",level:3},{value:"ChatGLM examples",id:"chatglm-examples",level:3},{value:"Moonshot AI examples",id:"moonshot-ai-examples",level:3},{value:"Custom response format",id:"custom-response-format",level:2},{value:"Custom request format",id:"custom-request-format",level:2},{value:"Custom Request (header/body/message-keys)",id:"custom-request-headerbodymessage-keys",level:3}];function d(e){const s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.header,{children:(0,o.jsx)(s.h1,{id:"custom-llm-server",children:"Custom LLM Server"})}),"\n",(0,o.jsx)(s.h2,{id:"custom-llm-server-example",children:"Custom LLM Server Example"}),"\n",(0,o.jsx)(s.h3,{id:"deepseek-ai-examples",children:"DeepSeek AI examples"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Custom Response Type\uff1aSSE"}),"\n",(0,o.jsxs)(s.li,{children:["Custom Engine Server\uff1a",(0,o.jsx)(s.a,{href:"https://api.deepseek.com/v1/chat/completions",children:"https://api.deepseek.com/v1/chat/completions"})]}),"\n",(0,o.jsx)(s.li,{children:"Request body format:"}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-json",children:'{ "customFields": {"model": "deepseek-chat", "stream": true} }\n'})}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Response format:"}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"$.choices[0].delta.content \n"})}),"\n",(0,o.jsx)(s.h3,{id:"\u96f6\u4e00\u4e07\u7269-examples",children:"\u96f6\u4e00\u4e07\u7269 examples"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Custom Response Type\uff1aSSE"}),"\n",(0,o.jsxs)(s.li,{children:["Custom Engine Server\uff1a",(0,o.jsx)(s.a,{href:"https://api.lingyiwangwu.com/v1/chat/completions",children:"https://api.lingyiwangwu.com/v1/chat/completions"})]}),"\n",(0,o.jsx)(s.li,{children:"Request body format:"}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-json",children:'{ "customFields": {"model": "yi-34b-chat", "stream": true} }\n'})}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Response format:"}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"$.choices[0].delta.content \n"})}),"\n",(0,o.jsx)(s.h3,{id:"chatglm-examples",children:"ChatGLM examples"}),"\n",(0,o.jsxs)(s.p,{children:["more detail see in: ",(0,o.jsx)(s.a,{href:"https://github.com/unit-mesh/auto-dev/issues/90",children:"#90"})]}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Custom Response Type\uff1aSSE"}),"\n",(0,o.jsxs)(s.li,{children:["Custom Engine Server\uff1a",(0,o.jsx)(s.a,{href:"https://open.bigmodel.cn/api/paas/v4/chat/completions",children:"https://open.bigmodel.cn/api/paas/v4/chat/completions"})]}),"\n",(0,o.jsx)(s.li,{children:"Request body format:"}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-json",children:'{ "customFields": {"model": "glm-4", "stream": true} }\n'})}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Response format:"}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"$.choices[0].delta.content \n"})}),"\n",(0,o.jsx)(s.h3,{id:"moonshot-ai-examples",children:"Moonshot AI examples"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Custom Response Type\uff1aSSE"}),"\n",(0,o.jsxs)(s.li,{children:["Custom Engine Server\uff1a",(0,o.jsx)(s.a,{href:"https://api.moonshot.cn/v1/chat/completions",children:"https://api.moonshot.cn/v1/chat/completions"})]}),"\n",(0,o.jsx)(s.li,{children:"Request body format"}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-json",children:'{ "customFields": {"model": "moonshot-v1-8k", "stream": true } }\n'})}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Response format:"}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"$.choices[0].delta.content\n"})}),"\n",(0,o.jsx)(s.h2,{id:"custom-response-format",children:"Custom response format"}),"\n",(0,o.jsxs)(s.p,{children:["We used ",(0,o.jsx)(s.a,{href:"https://github.com/json-path/JsonPath",children:"JsonPath"})," to parse response,\ncurrently we only extract the first choice and only the response message.\nIf your response is this format:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-json",children:'{\n  "id": "chatcmpl-123",\n  "object": "chat.completion.chunk",\n  "created": 1677652288,\n  "model": "gpt-3.5-turbo",\n  "choices": [{\n    "index": 0,\n    "delta": {\n      "content": "Hello"\n    },\n    "finish_reason": "stop"\n  }]\n}\n'})}),"\n",(0,o.jsxs)(s.p,{children:["You need to set the ",(0,o.jsx)(s.code,{children:"response format"})," to:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-text",children:"$.choices[0].message.delta.content\n"})}),"\n",(0,o.jsx)(s.h2,{id:"custom-request-format",children:"Custom request format"}),"\n",(0,o.jsx)(s.p,{children:"Only support number of request parameters like OpenAI does.\nOnly support http request that doesn't need encryption keys(like websocket)"}),"\n",(0,o.jsx)(s.h3,{id:"custom-request-headerbodymessage-keys",children:"Custom Request (header/body/message-keys)"}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsxs)(s.strong,{children:["BE CAREFUL: In this project, messageKey is not compatible with openAI: messageKeys: ",(0,o.jsx)(s.code,{children:'{ { "content": "content" } }'}),"is REQUIRED"]})," ",(0,o.jsx)(s.em,{children:"maybe we will fix this in the future."})]}),"\n",(0,o.jsx)(s.p,{children:"If your llm server has a custom request format, you can:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["Add top level field to the request body via ",(0,o.jsx)(s.code,{children:"customFields"})]}),"\n",(0,o.jsxs)(s.li,{children:["Add custom headers to the request via ",(0,o.jsx)(s.code,{children:"customHeaders"})]}),"\n",(0,o.jsxs)(s.li,{children:["Customize the messages key via ",(0,o.jsx)(s.code,{children:"messageKeys"})," (optional)"]}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"For example:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-json",children:'{ "customFields": {"user": "12345", "model":"model-name", "stream": true},  "messageKeys": { "content": "content" }}\n'})}),"\n",(0,o.jsx)(s.p,{children:"Or with custom headers:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-json",children:'{\n  "customHeaders": { "CustomHeader": "my-value" },\n  "customFields": {"user": "12345", "model": "gpt-4"},\n  "messageKeys": {"role": "role", "content": "message"}\n}\n'})}),"\n",(0,o.jsx)(s.p,{children:"Request header will be( origin key is omitted here):"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-http-request",children:"POST https://your.server.com/path\n\nCustomHeader: my-value\n...(other headers)\n"})}),"\n",(0,o.jsx)(s.p,{children:"And the request body will be:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-json",children:'{\n  "user": "12345",\n  "model": "gpt-4",\n  "messages": [\n    {\n      "role": "user",\n      "message": "..."\n    }\n  ]\n}\n'})})]})}function m(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>c});var t=n(6540);const o={},r=t.createContext(o);function l(e){const s=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);