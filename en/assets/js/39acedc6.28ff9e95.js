"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7575],{8453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>i});var t=n(6540);const o={},r=t.createContext(o);function l(e){const s=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),t.createElement(r.Provider,{value:s},e.children)}},8639:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"customize/custom-llm-server","title":"Custom LLM Server","description":"Custom LLM Server Example","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/customize/custom-llm-server.md","sourceDirName":"customize","slug":"/customize/custom-llm-server","permalink":"/en/customize/custom-llm-server","draft":false,"unlisted":false,"editUrl":"https://github.com/unit-mesh/auto-dev/tree/master/docs/docs/customize/custom-llm-server.md","tags":[],"version":"current","frontMatter":{"layout":"default","title":"Custom LLM Server","parent":"Customize Features","nav_order":14,"permalink":"/custom/llm-server"},"sidebar":"customizeSidebar","previous":{"title":"Custom Documentation","permalink":"/en/customize/custom-living-documentation"},"next":{"title":"Custom Quick Action","permalink":"/en/customize/custom-quick-action"}}');var o=n(4848),r=n(8453);const l={layout:"default",title:"Custom LLM Server",parent:"Customize Features",nav_order:14,permalink:"/custom/llm-server"},i="Custom LLM Server",c={},a=[{value:"Custom LLM Server Example",id:"custom-llm-server-example",level:2},{value:"DeepSeek AI Examples",id:"deepseek-ai-examples",level:3},{value:"Lingyiwanwu Examples",id:"lingyiwanwu-examples",level:3},{value:"ChatGLM Examples",id:"chatglm-examples",level:3},{value:"Moonshot AI Examples",id:"moonshot-ai-examples",level:3},{value:"Custom Response Format",id:"custom-response-format",level:2},{value:"Custom Request Format",id:"custom-request-format",level:2},{value:"Custom Request (header/body/message-keys)",id:"custom-request-headerbodymessage-keys",level:3}];function d(e){const s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.header,{children:(0,o.jsx)(s.h1,{id:"custom-llm-server",children:"Custom LLM Server"})}),"\n",(0,o.jsx)(s.h2,{id:"custom-llm-server-example",children:"Custom LLM Server Example"}),"\n",(0,o.jsx)(s.h3,{id:"deepseek-ai-examples",children:"DeepSeek AI Examples"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Custom Response Type: SSE"}),"\n",(0,o.jsxs)(s.li,{children:["Custom Engine Server: ",(0,o.jsx)(s.a,{href:"https://api.deepseek.com/v1/chat/completions",children:"https://api.deepseek.com/v1/chat/completions"})]}),"\n",(0,o.jsx)(s.li,{children:"Request body format:"}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-json",children:'{ "customFields": {"model": "deepseek-chat", "stream": true} }\n'})}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Response format:"}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"$.choices[0].delta.content \n"})}),"\n",(0,o.jsx)(s.h3,{id:"lingyiwanwu-examples",children:"Lingyiwanwu Examples"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Custom Response Type: SSE"}),"\n",(0,o.jsxs)(s.li,{children:["Custom Engine Server: ",(0,o.jsx)(s.a,{href:"https://api.lingyiwangwu.com/v1/chat/completions",children:"https://api.lingyiwangwu.com/v1/chat/completions"})]}),"\n",(0,o.jsx)(s.li,{children:"Request body format:"}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-json",children:'{ "customFields": {"model": "yi-34b-chat", "stream": true} }\n'})}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Response format:"}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"$.choices[0].delta.content \n"})}),"\n",(0,o.jsx)(s.h3,{id:"chatglm-examples",children:"ChatGLM Examples"}),"\n",(0,o.jsxs)(s.p,{children:["More details see: ",(0,o.jsx)(s.a,{href:"https://github.com/unit-mesh/auto-dev/issues/90",children:"#90"})]}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Custom Response Type: SSE"}),"\n",(0,o.jsxs)(s.li,{children:["Custom Engine Server: ",(0,o.jsx)(s.a,{href:"https://open.bigmodel.cn/api/paas/v4/chat/completions",children:"https://open.bigmodel.cn/api/paas/v4/chat/completions"})]}),"\n",(0,o.jsx)(s.li,{children:"Request body format:"}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-json",children:'{ "customFields": {"model": "glm-4", "stream": true} }\n'})}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Response format:"}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"$.choices[0].delta.content \n"})}),"\n",(0,o.jsx)(s.h3,{id:"moonshot-ai-examples",children:"Moonshot AI Examples"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Custom Response Type: SSE"}),"\n",(0,o.jsxs)(s.li,{children:["Custom Engine Server: ",(0,o.jsx)(s.a,{href:"https://api.moonshot.cn/v1/chat/completions",children:"https://api.moonshot.cn/v1/chat/completions"})]}),"\n",(0,o.jsx)(s.li,{children:"Request body format:"}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-json",children:'{ "customFields": {"model": "moonshot-v1-8k", "stream": true } }\n'})}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Response format:"}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"$.choices[0].delta.content\n"})}),"\n",(0,o.jsx)(s.h2,{id:"custom-response-format",children:"Custom Response Format"}),"\n",(0,o.jsxs)(s.p,{children:["We use ",(0,o.jsx)(s.a,{href:"https://github.com/json-path/JsonPath",children:"JsonPath"})," to parse responses.\nCurrently we only extract the first choice and the response message content.\nIf your response follows this format:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-json",children:'{\n  "id": "chatcmpl-123",\n  "object": "chat.completion.chunk",\n  "created": 1677652288,\n  "model": "gpt-3.5-turbo",\n  "choices": [{\n    "index": 0,\n    "delta": {\n      "content": "Hello"\n    },\n    "finish_reason": "stop"\n  }]\n}\n'})}),"\n",(0,o.jsxs)(s.p,{children:["You should set the ",(0,o.jsx)(s.code,{children:"response format"})," to:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-text",children:"$.choices[0].message.delta.content\n"})}),"\n",(0,o.jsx)(s.h2,{id:"custom-request-format",children:"Custom Request Format"}),"\n",(0,o.jsx)(s.p,{children:"Only supports request parameters similar to OpenAI's specification.\nOnly supports HTTP requests that don't require encryption keys (e.g., websocket is not supported)."}),"\n",(0,o.jsx)(s.h3,{id:"custom-request-headerbodymessage-keys",children:"Custom Request (header/body/message-keys)"}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsxs)(s.strong,{children:["IMPORTANT: In this project, messageKey is not fully compatible with OpenAI: The ",(0,o.jsx)(s.code,{children:'messageKeys: { { "content": "content" } }'})," configuration is REQUIRED"]})," ",(0,o.jsx)(s.em,{children:"This might be improved in future versions."})]}),"\n",(0,o.jsx)(s.p,{children:"If your LLM server requires custom request formatting, you can:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["Add top-level fields to the request body via ",(0,o.jsx)(s.code,{children:"customFields"})]}),"\n",(0,o.jsxs)(s.li,{children:["Add custom headers via ",(0,o.jsx)(s.code,{children:"customHeaders"})]}),"\n",(0,o.jsxs)(s.li,{children:["Customize message keys via ",(0,o.jsx)(s.code,{children:"messageKeys"})," (optional)"]}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"Example:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-json",children:'{ "customFields": {"user": "12345", "model":"model-name", "stream": true},  "messageKeys": { "content": "content" }}\n'})}),"\n",(0,o.jsx)(s.p,{children:"Example with custom headers:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-json",children:'{\n  "customHeaders": { "CustomHeader": "my-value" },\n  "customFields": {"user": "12345", "model": "gpt-4"},\n  "messageKeys": {"role": "role", "content": "message"}\n}\n'})}),"\n",(0,o.jsx)(s.p,{children:"The request header will be (original headers omitted):"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-http-request",children:"POST https://your.server.com/path\n\nCustomHeader: my-value\n...(other headers)\n"})}),"\n",(0,o.jsx)(s.p,{children:"The request body will be formatted as:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-json",children:'{\n  "user": "12345",\n  "model": "gpt-4",\n  "messages": [\n    {\n      "role": "user",\n      "message": "..."\n    }\n  ]\n}\n'})})]})}function m(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);